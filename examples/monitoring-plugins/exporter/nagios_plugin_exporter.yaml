---
default_module: http
modules:
  # /probe?module=http&target=example.com:8443
  http:
    plugin:
      - /usr/bin/sudo
      - /usr/lib/nagios/plugins/check_http
    timeout: 60
    perfdata:
      time:
        metric: time_request
        type: gauge
      time_connect:
        type: gauge
      time_ssl:
        type: gauge
      time_firstbyte:
        type: gauge
      time_headers:
        type: gauge
      time_transfer:
        type: gauge
      size:
        type: gauge
    args:
      "-H":
        set_if: "{{ if (url_port .params.target | eq 80) }}true{{end}}"
        value: |
          {{ url_host .params.target }}
          example.com
        order: 2
        key: "-H"
        required: true
        repeat_key: true
        skip_key: true
        separator: "="
      "-p": "{{ .env.PASSWORD }}"
      "-C": "{{ read_file /run/secrets/cipher }}"
